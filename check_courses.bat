@echo off
chcp 65001 >nul
setlocal enabledelayedexpansion

echo ================================================================================
echo è¯¾ç¨‹è§†é¢‘å®Œæ•´æ€§æ£€æŸ¥å·¥å…·
echo ================================================================================
echo.

set total_videos=0
set total_subtitles=0
set missing_subs=0
set orphan_subs=0
set zero_byte_videos=0

echo æ­£åœ¨æ‰«æè§†é¢‘æ–‡ä»¶...
echo.

REM åˆ›å»ºä¸´æ—¶æ–‡ä»¶
set temp_videos=%temp%\videos_list.txt
set temp_subs=%temp%\subs_list.txt
set temp_report=%temp%\report.txt

REM æ¸…ç©ºä¸´æ—¶æ–‡ä»¶
type nul > %temp_videos%
type nul > %temp_subs%
type nul > %temp_report%

REM æŸ¥æ‰¾æ‰€æœ‰è§†é¢‘å’Œå­—å¹•æ–‡ä»¶
for /r %%f in (*.mp4) do (
    set /a total_videos+=1
    echo %%f>> %temp_videos%
)

for /r %%f in (*_en.srt) do (
    set /a total_subtitles+=1
    echo %%f>> %temp_subs%
)

echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo ðŸ“Š ç»Ÿè®¡ä¿¡æ¯
echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo   æ€»è§†é¢‘æ•°: !total_videos!
echo   æ€»å­—å¹•æ•°: !total_subtitles!
echo.

echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo ðŸ” æ£€æŸ¥é—®é¢˜ä¸­...
echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo.

REM æ£€æŸ¥0å­—èŠ‚è§†é¢‘æ–‡ä»¶
echo [ä¸¥é‡] æ£€æŸ¥0å­—èŠ‚è§†é¢‘æ–‡ä»¶...
for /r %%f in (*.mp4) do (
    if %%~zf==0 (
        set /a zero_byte_videos+=1
        echo   âŒ 0å­—èŠ‚è§†é¢‘: %%f
        echo [ä¸¥é‡] 0å­—èŠ‚è§†é¢‘: %%f >> %temp_report%
    )
)
if !zero_byte_videos!==0 (
    echo   âœ… æœªå‘çŽ°0å­—èŠ‚è§†é¢‘
)
echo.

REM æ£€æŸ¥æœ‰å­—å¹•ä½†æ²¡è§†é¢‘çš„æƒ…å†µï¼ˆä¸¥é‡é—®é¢˜ï¼‰
echo [ä¸¥é‡] æ£€æŸ¥å­¤ç«‹å­—å¹•æ–‡ä»¶ï¼ˆæœ‰å­—å¹•ä½†æ— è§†é¢‘ï¼‰...
for /r %%f in (*_en.srt) do (
    set "sub_file=%%f"
    set "sub_name=%%~nf"
    REM ç§»é™¤ _en åŽç¼€
    set "video_name=!sub_name:~0,-3!"
    set "video_path=%%~dpf!video_name!.mp4"

    if not exist "!video_path!" (
        set /a orphan_subs+=1
        echo   âŒ å­¤ç«‹å­—å¹•: %%f
        echo [ä¸¥é‡] å­¤ç«‹å­—å¹•ï¼ˆæ— å¯¹åº”è§†é¢‘ï¼‰: %%f >> %temp_report%
    )
)
if !orphan_subs!==0 (
    echo   âœ… æœªå‘çŽ°å­¤ç«‹å­—å¹•
)
echo.

REM æ£€æŸ¥æœ‰è§†é¢‘ä½†æ²¡å­—å¹•çš„æƒ…å†µï¼ˆè­¦å‘Šï¼‰
echo [è­¦å‘Š] æ£€æŸ¥ç¼ºå°‘å­—å¹•çš„è§†é¢‘...
for /r %%f in (*.mp4) do (
    set "video_file=%%f"
    set "video_name=%%~nf"
    set "sub_path=%%~dpf!video_name!_en.srt"

    if not exist "!sub_path!" (
        set /a missing_subs+=1
        if !missing_subs! LEQ 10 (
            echo   âš ï¸  ç¼ºå°‘å­—å¹•: %%f
        )
        echo [è­¦å‘Š] ç¼ºå°‘å­—å¹•: %%f >> %temp_report%
    )
)
if !missing_subs!==0 (
    echo   âœ… æ‰€æœ‰è§†é¢‘éƒ½æœ‰å­—å¹•
) else (
    if !missing_subs! GTR 10 (
        echo   ... è¿˜æœ‰ !missing_subs! ä¸ªè§†é¢‘ç¼ºå°‘å­—å¹•ï¼ˆä»…æ˜¾ç¤ºå‰10ä¸ªï¼‰
    )
)
echo.

echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo ðŸ“‹ æ£€æŸ¥ç»“æžœæ±‡æ€»
echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo.
echo   âŒ ä¸¥é‡é—®é¢˜:
echo      - 0å­—èŠ‚è§†é¢‘: !zero_byte_videos! ä¸ª
echo      - å­¤ç«‹å­—å¹•ï¼ˆæ— è§†é¢‘ï¼‰: !orphan_subs! ä¸ª
echo.
echo   âš ï¸  è­¦å‘Š:
echo      - ç¼ºå°‘å­—å¹•çš„è§†é¢‘: !missing_subs! ä¸ª
echo.

if !zero_byte_videos!==0 if !orphan_subs!==0 (
    echo   âœ… æ²¡æœ‰ä¸¥é‡é—®é¢˜ï¼Œè§†é¢‘æ–‡ä»¶å®Œæ•´ï¼
) else (
    echo   âš ï¸  å‘çŽ°ä¸¥é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥ä¸Šè¿°æ–‡ä»¶ï¼
)

echo.
echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜åˆ°: %temp_report%
echo â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
echo.

REM è¯¢é—®æ˜¯å¦æ‰“å¼€è¯¦ç»†æŠ¥å‘Š
set /p open_report="æ˜¯å¦æ‰“å¼€è¯¦ç»†æŠ¥å‘Šï¼Ÿ(Y/N): "
if /i "!open_report!"=="Y" (
    notepad %temp_report%
)

REM æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼ˆä¿ç•™æŠ¥å‘Šï¼‰
del %temp_videos% 2>nul
del %temp_subs% 2>nul

echo.
pause
